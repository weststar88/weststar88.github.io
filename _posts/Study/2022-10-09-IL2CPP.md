---
layout: post
title:  "IL2CPP"
categories: Study
tags: [IL2CPP,AOT,JIT]
---

## IL2CPP

유니티 엔진내부는 cpp로 되어있다.
유저코드는 C#으로 되어있지만 IL2CPP 를 이용하여 유저코드도 cpp로 돌릴 수 있게 된다.

### C# 과 CPP의 차이

cpp는 메모리관리를 직접해줘야 하지만 c#은 알아서 해줌(garbage collector)
c# 으로 개발하면 메모리관리같은 귀찮은 작업들을 c#이 알아서 해주기때문에 비교적 개발이 쉬워지고 cpp로 개발하는거에 비해서 생산성이 높아짐
하지만 성능적으로는 cpp보다 떨어짐 (가비지콜렉터의 한계? cpp에서는 메모리를 직접 할당/해제하기때문에 내가 쓸만큼쓰고 바로 메모리를 해제할 수 있지만 가비지콜렉터는 그렇게까지 알아서 해주지못함)

### 다시 본론 

C#같은 경우엔 .net프레임워크로 돌리기 때문에 .net이 설치되어 있지않은(윈도우가 아닌) 플랫폼에서 원래라면 실행이 불가능하다.
하지만 유니티로 빌드한 프로그램이 애플쪽이나 안드로이드에서 돌아가는 이유는 윈도우 이외의 운영체제에서도 c#을 사용할수있도록 하기위해 만들어진 프로젝트인 모노 프레임워크를 사용해서 그렇다.
모노는 리눅스 기반이기때문에 여러 플랫폼에서 동작이 가능. (모노는 마이크로소프트에서 인수해서 xamarin 이라는 프로젝트로 계속 발전시키고 있음)

C#을 mono에서 돌리기위해 IL(intermediate language 중간언어, .net 어셈블리?)이라는 언어로 변환을 하고
모노는 IL을 런타임에서 실시간으로 컴파일을 하면서 프로그램을 구동함. JIT(just in time)방식 (인터프리터 방식보다는 좀 더 빠름, 이미 한번 변환한 상태이기 때문에)

유니티에서는 이 JIT방식보다 더 빠른 속도를 내기 위해 IL을 한번더 변환하여 CPP로 만드는 방식을 제공한다. (빌드시간과 빌드 용량은 더 늘어나지만 빌드된 프로그램의 성능은 향상된다.)

mono컴파일러가 c#을 IL로 바꿔주는것 까지는 지원을 하고있기때문에 유니티에서는 IL을 cpp로 변환해주는 기능을 추가한 것.
c++로 변환하게 되면 애플쪽은 object-c 에서 c++ 바인드를 지원하기때문에 애플쪽에서도 실행 가능하고 안드로이드는 ndk를 통해서 c++ 코드를 실행할 수 있다고 한다.

## 정리
C#을 IL 로 변환해서 MONO 프레임워크 위에서 돌리게 되면 JIT방식 (에디터에서 이방식을 사용)
C#을 IL2CPP를 이용해서 C++로 변환 기계어로 컴파일하게되면 AOT방식 (ahead of time)



출처 : ![UNITY_TIPS](//https://www.youtube.com/watch?v=-9X965jXrn8)